import{a as Y,r as o,b as U,j as e}from"./index-Di1m-Kd0.js";import{u as z}from"./useApplication-COf7xta7.js";import{P as Q,a as T,D as j,b as V}from"./style-Dw99P7r5.js";import{c as x,e as G}from"./en-DRrnaR5F.js";import"./applicationApi-CCPG1awT.js";const N=["fullName","email","phone","dateOfBirth","nationality","address"];x.registerLocale(G);x.registerLocale(V);const ee=()=>{const{t:i,i18n:w}=Y(),[B,p]=o.useState(1),[r,g]=o.useState(!1),[t,b]=o.useState({address:""}),[a,O]=o.useState({}),[H,J]=o.useState(!1),[v,l]=o.useState(null),{isLoggedIn:k,user:E}=U(),d=z(),{submitDrivingLicense:I}=d,f=o.useCallback((n,c)=>{O(s=>({...s,[c]:n}))},[]),u=o.useCallback((n,c)=>{if(c==="phone"&&typeof n=="string")b(s=>({...s,phone:n}));else if(typeof n=="object"&&"target"in n){const{name:s,value:m}=n.target;b(h=>({...h,[s]:m}))}},[]),R=async n=>{if(n.preventDefault(),l(null),t.dateOfBirth&&new Date().getFullYear()-new Date(t.dateOfBirth).getFullYear()<18){l(i("common.age_validation"));return}const s=N.filter(L=>!t[L]);if(s.length>0){l(`${i("common.fill_required_fields")}: ${s.join(", ")}`);return}if(!a.idCopy||!a.photo||!a.oldLicenseCopy){l(i("common.upload_required_documents"));return}if(!E?.id){l(i("common.login_required_text"));return}const{fullName:m,email:h,phone:_,dateOfBirth:y,nationality:C,address:q}=t,{idCopy:F,photo:D,oldLicenseCopy:S}=a;if(!m||!h||!_||!y||!C||!q||!F||!D||!S){l(i("common.fill_required_fields"));return}const A={fullName:m,email:h,phone:_,nationality:C,address:q,idCopy:F,photo:D,oldLicenseCopy:S,dateOfBirth:new Date(y).toISOString()};await I(A),d.trackingNumber&&p(4)},P=o.useCallback(n=>{n.preventDefault();const s=N.filter(m=>!t[m]);if(s.length>0){l(`${i("common.fill_required_fields")}: ${s.join(", ")}`);return}if(!a.idCopy||!a.photo||!a.oldLicenseCopy){l(i("common.upload_required_documents"));return}l(null),g(!0),p(2)},[t,a,i]),$=[i("idl.steps.upload"),i("idl.steps.review"),i("idl.steps.payment"),i("idl.steps.delivery")];return d.trackingNumber?e.jsxs("div",{children:[e.jsx("h2",{children:i("common.submission_successful")}),e.jsx("p",{children:"Your application has been successfully submitted and is being processed."}),e.jsxs("p",{children:[i("common.tracking_number_is"),": ",d.trackingNumber]})]}):e.jsxs("div",{children:[e.jsx("h1",{children:i("idl.title")}),e.jsx("p",{children:i("idl.subtitle")}),e.jsxs("div",{children:[e.jsx(Q,{currentStep:B,steps:$}),k?e.jsxs("form",{onSubmit:r?R:P,children:[e.jsxs("div",{children:[e.jsx("h3",{children:i("common.personal_information")}),e.jsxs("div",{children:[e.jsx("label",{children:"Full Name"}),e.jsx("input",{name:"fullName",value:t.fullName||"",placeholder:i("common.full_name"),onChange:u,required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Email"}),e.jsx("input",{name:"email",type:"email",placeholder:i("common.email"),value:t.email||"",onChange:u,required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Phone"}),e.jsx(T,{name:"phone",placeholder:i("common.phone"),value:t.phone,onChange:n=>u(n||"","phone"),required:!0,disabled:r,defaultCountry:"US",international:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Date of Birth"}),e.jsx("input",{name:"dateOfBirth",type:"date",placeholder:i("common.date_of_birth"),value:t.dateOfBirth||"",onChange:u,required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Nationality"}),e.jsxs("select",{name:"nationality",value:t.nationality||"",onChange:u,required:!0,disabled:r,children:[e.jsx("option",{value:"",children:i("common.select_nationality")}),Object.entries(x.getNames(w.language==="ar"?"ar":"en")).map(([n,c])=>e.jsx("option",{value:c,children:c},n))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Address"}),e.jsx("input",{name:"address",value:t.address||"",placeholder:i("common.address"),onChange:u,required:!0,disabled:r})]})]}),e.jsxs("div",{children:[e.jsx("h3",{children:i("common.required_documents")}),e.jsx(j,{onFileChange:n=>f(n,"idCopy"),label:i("idl.id_copy")}),e.jsx(j,{onFileChange:n=>f(n,"photo"),label:i("idl.personal_photo")}),e.jsx(j,{onFileChange:n=>f(n,"oldLicenseCopy"),label:i("idl.old_license_copy")})]}),(v||d.error)&&e.jsx("div",{style:{color:"red"},children:e.jsx("p",{children:v||d.error})}),e.jsx("div",{children:r?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),p(1)},children:i("common.edit")}),e.jsx("button",{type:"submit",disabled:d.loading,children:d.loading?i("common.submitting"):i("common.submit_application")})]}):e.jsx("button",{type:"submit",children:i("common.review_application")})})]}):e.jsxs("div",{children:[e.jsx("h3",{children:i("common.login_required_title")}),e.jsx("p",{children:i("common.login_required_text")})]})]})]})};export{ee as default};
